<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Name="ThisPage"
							 x:Class="NeuroAccessMaui.UI.Pages.Contracts.ViewContract.ViewContractPage"
							 x:DataType="viewmodel:ViewContractViewModel"
							 xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
							 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
							 xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
							 xmlns:ui="clr-namespace:NeuroAccessMaui.UI"
							 xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
							 xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
							 xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
							 xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
							 xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Contracts.ViewContract"
							 xmlns:objectmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Contracts.ViewContract.ObjectModel"
							 xmlns:photos="clr-namespace:NeuroAccessMaui.Services.UI.Photos"
							 xmlns:image="clr-namespace:NeuroAccessMaui.UI.Popups.Photos.Image">
	<Grid BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryBackgroundLight}, Dark={StaticResource PrimaryBackgroundDark}}">

		<controls:Background/>

		<ScrollView>
			<VerticalStackLayout Spacing="{StaticResource SmallSpacing}" Margin="{StaticResource MediumSpacing}">
				<controls:ImageButton HorizontalOptions="Start" Command="{Binding GoBackCommand}"
											 Style="{StaticResource ImageOnlyButton}" PathData="{x:Static ui:Geometries.BackButtonPath}" />

				<Label Text="{l:Localize ViewContract}" Style="{StaticResource PageTitleLabel}"/>

				<Frame Style="{StaticResource FrameSet}">
					<VerticalStackLayout Spacing="{StaticResource LargeSpacing}">
						<!-- Proposal -->
						<Label Text="{l:Localize Proposal}" 
                       Margin="{StaticResource SmallTopMargins}" IsVisible="{Binding Path=IsProposal}" />
						<Label Text="{Binding Path=Proposal}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=IsProposal}" />
						<!-- HUMAN READABLE TEXT -->
						<Label Text="{l:Localize HumanReadableText}" IsVisible="{Binding Path=HasHumanReadableText}" Margin="{StaticResource SmallBottomMargins}" VerticalOptions="StartAndExpand" />
						<ContentView Content="{Binding Path=HumanReadableText}" VerticalOptions="StartAndExpand"/>
						<!-- GENERAL -->
						<Label Text="{l:Localize GeneralInformation}" Margin="{StaticResource SmallTopMargins}" />
						<Label Text="{l:Localize GeneralInformationInfoText}" Style="{StaticResource InfoLabel}" />
						<StackLayout Orientation="Vertical" BindableLayout.ItemsSource="{Binding Path=GeneralInformation}">
							<BindableLayout.ItemTemplate>
								<DataTemplate x:DataType="objectmodel:PartModel">
									<StackLayout Orientation="Horizontal">
										<Label Text="{Binding Path=Key}" Style="{StaticResource KeyLabel}"/>
										<Label LineBreakMode="NoWrap" Text="{Binding Path=Value}" Style="{StaticResource ValueLabel}"
                                       BackgroundColor="{Binding BgColor}"/>
									</StackLayout>
								</DataTemplate>
							</BindableLayout.ItemTemplate>
						</StackLayout>
						<!-- PHOTOS -->
						<StackLayout Orientation="Horizontal" IsVisible="{Binding Path=HasPhotos}" VerticalOptions="StartAndExpand">
							<Label Text="{l:Localize Photos}" HorizontalOptions="StartAndExpand" />
							<ScrollView Orientation="Horizontal" HeightRequest="68">
								<FlexLayout x:Name="PhotosLayout"
                                    AlignContent="Center"
                                    AlignItems="Center" 
                                    Direction="Row" 
                                    JustifyContent="Start" 
                                    BindableLayout.ItemsSource="{Binding Path=Photos}">
									<BindableLayout.ItemTemplate>
										<DataTemplate x:DataType="photos:Photo">
											<Image Source="{Binding Path=Source}" Rotation="{Binding Path=Rotation}" HeightRequest="64" WidthRequest="64" Aspect="AspectFill" Margin="2">
												<Image.GestureRecognizers>
													<TapGestureRecognizer Tapped="Image_Tapped"/>
												</Image.GestureRecognizers>
											</Image>
										</DataTemplate>
									</BindableLayout.ItemTemplate>
								</FlexLayout>
							</ScrollView>
						</StackLayout>
						<!-- QR -->
						<Image x:Name="QrCode" Source="{Binding Path=QrCode}" IsVisible="{Binding Path=HasQrCode}" WidthRequest="{Binding Path=QrCodeWidth, Mode=OneTime}" HeightRequest="{Binding Path=QrCodeHeight, Mode=OneTime}" VerticalOptions="StartAndExpand" HorizontalOptions="CenterAndExpand" Margin="{StaticResource SmallTopMargins}" />
						<!-- ROLES -->
						<Label Text="{l:Localize Roles}" IsVisible="{Binding Path=HasRoles}" Margin="{StaticResource SmallTopMargins}" VerticalOptions="StartAndExpand" />
						<Label Text="{l:Localize RolesInfoText}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=HasRoles}" VerticalOptions="StartAndExpand"/>
						<ContentView Content="{Binding Path=Roles}" VerticalOptions="StartAndExpand"/>
						<!-- PARTs -->
						<Label Text="{l:Localize Parts}" IsVisible="{Binding Path=HasParts}" Margin="{StaticResource SmallTopMargins}" VerticalOptions="StartAndExpand" />
						<Label Text="{l:Localize PartsInfoText}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=HasParts}"  VerticalOptions="StartAndExpand" />
						<ContentView Content="{Binding Path=Parts}" VerticalOptions="StartAndExpand" />
						<!-- PARAMETERS -->
						<Label Text="{l:Localize Parameters}" IsVisible="{Binding Path=HasParameters}" Margin="{StaticResource SmallTopMargins}" VerticalOptions="StartAndExpand" />
						<Label Text="{l:Localize ParametersInfoText}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=HasParameters}" VerticalOptions="StartAndExpand" />
						<ContentView Content="{Binding Path=Parameters}" VerticalOptions="StartAndExpand"/>
						<!-- MACHINE READABLE TEXT -->
						<Label Text="{l:Localize MachineReadableText}" IsVisible="{Binding Path=HasMachineReadableText}" Margin="{StaticResource SmallTopMargins}" VerticalOptions="StartAndExpand" />
						<Label Text="{l:Localize MachineReadableInfoText}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=HasMachineReadableText}" VerticalOptions="StartAndExpand" />
						<ContentView Content="{Binding Path=MachineReadableText}" VerticalOptions="StartAndExpand"/>
						<Button Text="{l:Localize ShowDetails}" Margin="{StaticResource SmallBottomMargins}"
                        Command="{Binding Path=ShowDetailsCommand}" IsEnabled="{Binding Path=IsBusy, Converter={StaticResource InvertedBoolConverter}}" />
						<!-- CLIENT SIGNATURES -->
						<Label Text="{l:Localize ClientSignatures}" IsVisible="{Binding Path=HasClientSignatures}" Margin="{StaticResource SmallTopMargins}" VerticalOptions="StartAndExpand" />
						<Label Text="{l:Localize ClientSignaturesInfoText}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=HasClientSignatures}" VerticalOptions="StartAndExpand" />
						<ContentView Content="{Binding Path=ClientSignatures}" VerticalOptions="StartAndExpand"/>
						<!-- SERVER SIGNATURES -->
						<Label Text="{l:Localize ServerSignatures}" IsVisible="{Binding Path=HasServerSignatures}" Margin="{StaticResource SmallTopMargins}" VerticalOptions="StartAndExpand" />
						<Label Text="{l:Localize ServerSignaturesInfoText}" Style="{StaticResource InfoLabel}" IsVisible="{Binding Path=HasServerSignatures}" VerticalOptions="StartAndExpand" />
						<ContentView Content="{Binding Path=ServerSignatures}" VerticalOptions="StartAndExpand"/>
						<!-- BUTTONS -->
						<Button Text="{l:Localize ObsoleteContract}" Command="{Binding Path=ObsoleteContractCommand}" IsVisible="{Binding Path=CanObsoleteContract}" Margin="{StaticResource SmallTopBottomMargins}"/>
						<Button Text="{l:Localize DeleteContract}" Command="{Binding Path=DeleteContractCommand}" IsVisible="{Binding Path=CanDeleteContract}" Margin="{StaticResource SmallBottomMargins}"/>
						<image:ImageView x:Name="PhotoViewer" IsVisible="False"/>
					</VerticalStackLayout>
				</Frame>
			</VerticalStackLayout>
		</ScrollView>
	</Grid>
</base:BaseContentPage>
