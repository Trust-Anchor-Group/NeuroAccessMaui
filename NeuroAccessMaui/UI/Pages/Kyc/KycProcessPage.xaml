<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Class="NeuroAccessMaui.UI.Pages.Kyc.KycProcessPage"
					  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
					  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
					  xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
					  xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
					  xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
					  xmlns:local="clr-namespace:NeuroAccessMaui.UI.Pages.Kyc"
					  xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
					  xmlns:models="clr-namespace:NeuroAccessMaui.Services.Kyc.Models"
					  xmlns:fields="clr-namespace:NeuroAccessMaui.Services.Kyc.ViewModels"
					  xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Kyc"
					  xmlns:ui="clr-namespace:NeuroAccessMaui.UI"
					  xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
					  x:DataType="viewmodel:KycProcessViewModel"
					  xmlns:IDSF="clr-namespace:NeuroAccessMaui.Services.Identity">

	<ContentPage.Resources>
		<ResourceDictionary>
			<Style TargetType="Label"
				   x:Key="SectionHeaderLabel">
				<Setter Property="FontSize"
						Value="24" />
			</Style>
			
			<!--  Field Styles  -->
			<Style x:Key="FieldKeyLabel" TargetType="Label">
				<Setter Property="FontSize" Value="14" />
				<Setter Property="FontFamily" Value="SpaceGroteskRegular" />
				<Setter Property="TextColor" Value="{DynamicResource ContentSecondaryWL}" />
			</Style>
			<Style x:Key="FieldValueLabel" TargetType="Label">
				<Setter Property="FontSize" Value="16" />
				<Setter Property="FontFamily" Value="SpaceGroteskRegular" />
				<Setter Property="TextColor" Value="{DynamicResource ContentPrimaryWL}" />
			</Style>
			<Style x:Key="FieldTitleLabel" TargetType="Label">
				<Setter Property="FontSize" Value="18" />
				<Setter Property="FontFamily" Value="SpaceGroteskBold" />
				<Setter Property="TextColor" Value="{DynamicResource ContentPrimaryWL}" />
			</Style>
			<Style x:Key="PageTitleLabel" TargetType="Label">
				<Setter Property="FontSize" Value="26" />
				<Setter Property="FontFamily" Value="SpaceGroteskBold" />
				<Setter Property="TextColor" Value="{DynamicResource ContentPrimaryWL}" />
			</Style>
			
			<Style x:Key="FileIconBorder" TargetType="Border">
				<Setter Property="Background" Value="{DynamicResource BrandColorsNeuroAccessv500WL}" />
				<Setter Property="StrokeShape" Value="RoundRectangle 8" />
				<Setter Property="Stroke" Value="Transparent"/>
				<Setter Property="WidthRequest" Value="40"/>
				<Setter Property="HeightRequest" Value="40"/>
			</Style>

			<!-- Text field template -->
			<DataTemplate x:Key="TextFieldTemplate"
						  x:DataType="fields:ObservableGenericField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositeEntry EntryData="{Binding StringValue, Mode=TwoWay}"
											 LabelText="{Binding Label.Text}"
											 Placeholder="{Binding Placeholder.Text}"
											 Style="{DynamicResource RegularCompositeEntry}"
											 Required="{Binding Required}"
											 IsValid="{Binding IsValid}"
											 ValidationText="{Binding ValidationText}" />
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Date field template -->
			<DataTemplate x:Key="DateFieldTemplate"
						  x:DataType="fields:ObservableDateField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositeDatePicker LabelText="{Binding Label.Text}"
												  NullableDate="{Binding DateValue, Mode=TwoWay}"
												  Placeholder="{Binding Placeholder.Text}"
												  Style="{DynamicResource RegularCompositeDatePicker}"
												  Required="{Binding Required}"
												  IsValid="{Binding IsValid}"
												  ValidationText="{Binding ValidationText}">
						<controls:CompositeDatePicker.RightView>
							<Path Data="{x:Static ui:Geometries.DropDownArrowPath}" Fill="{DynamicResource InputFieldsContentSecondary}" VerticalOptions="Center"/>
						</controls:CompositeDatePicker.RightView>
					</controls:CompositeDatePicker>
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Integer field template -->
			<DataTemplate x:Key="IntegerFieldTemplate"
						  x:DataType="fields:ObservableIntegerField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositeEntry EntryData="{Binding IntValue, Mode=TwoWay}"
											 LabelText="{Binding Label.Text}"
											 Placeholder="{Binding Placeholder.Text}"
											 Keyboard="Numeric"
											 Style="{DynamicResource RegularCompositeEntry}"
											 Required="{Binding Required}"
											 IsValid="{Binding IsValid}"
											 ValidationText="{Binding ValidationText}" />
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Decimal field template -->
			<DataTemplate x:Key="DecimalFieldTemplate"
						  x:DataType="fields:ObservableDecimalField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositeEntry EntryData="{Binding DecimalValue, Mode=TwoWay}"
											 LabelText="{Binding Label.Text}"
											 Placeholder="{Binding Placeholder.Text}"
											 Keyboard="Numeric"
											 Style="{DynamicResource RegularCompositeEntry}"
											 Required="{Binding Required}"
											 IsValid="{Binding IsValid}"
											 ValidationText="{Binding ValidationText}" />
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Picker field template -->
			<DataTemplate x:Key="PickerFieldTemplate"
						  x:DataType="fields:ObservablePickerField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositePicker ItemsSource="{Binding Options}"
											  LabelText="{Binding Label.Text}"
											  Placeholder="{Binding Placeholder.Text}"
											  SelectedItem="{Binding SelectedOption, Mode=TwoWay}"
											  Style="{DynamicResource RegularCompositePicker}"
											  Required="{Binding Required}"
											  IsValid="{Binding IsValid}"
											  ValidationText="{Binding ValidationText}">
						<controls:CompositePicker.RightView>
							<Path Data="{x:Static ui:Geometries.DropDownArrowPath}" Fill="{DynamicResource InputFieldsContentSecondary}" VerticalOptions="Center"/>
						</controls:CompositePicker.RightView>
						<controls:CompositePicker.ItemDisplayBinding>
							<Binding Path="Label.Text" />
						</controls:CompositePicker.ItemDisplayBinding>
					</controls:CompositePicker>
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Radio field template -->
			<DataTemplate x:Key="RadioFieldTemplate"
						  x:DataType="fields:ObservableRadioField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositePicker ItemsSource="{Binding Options}"
											  LabelText="{Binding Label.Text}"
											  Placeholder="{Binding Placeholder.Text}"
											  SelectedItem="{Binding SelectedOption, Mode=TwoWay}"
											  Style="{DynamicResource RegularCompositePicker}"
											  Required="{Binding Required}"
											  IsValid="{Binding IsValid}"
											  ValidationText="{Binding ValidationText}">
						<controls:CompositePicker.ItemDisplayBinding>
							<Binding Path="Label.Text" />
						</controls:CompositePicker.ItemDisplayBinding>
					</controls:CompositePicker>
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Country field template -->
			<DataTemplate x:Key="CountryFieldTemplate"
						  x:DataType="fields:ObservableCountryField">
				<VerticalStackLayout Spacing="2">
					<controls:CompositePicker ItemsSource="{Binding Options}"
											  LabelText="{Binding Label.Text}"
											  Placeholder="{Binding Placeholder.Text}"
											  SelectedItem="{Binding CountryCode, Mode=TwoWay}"
											  Style="{DynamicResource RegularCompositePicker}"
											  Required="{Binding Required}"
											  IsValid="{Binding IsValid}"
											  ValidationText="{Binding ValidationText}" >
						<controls:CompositePicker.RightView>
							<Path Data="{x:Static ui:Geometries.DropDownArrowPath}" Fill="{DynamicResource InputFieldsContentSecondary}" VerticalOptions="Center"/>
						</controls:CompositePicker.RightView>
						<controls:CompositePicker.ItemDisplayBinding>
							<Binding Path="Label.Text" />
						</controls:CompositePicker.ItemDisplayBinding>
					</controls:CompositePicker>
				</VerticalStackLayout>
			</DataTemplate>
			<!-- Checkbox field template using TemplatedSelector -->
			<DataTemplate x:Key="CheckboxFieldTemplate"
						  x:DataType="fields:ObservableCheckboxField">
				<controls:CompositeInputView LabelText="{Binding Label.Text}"
											 Style="{DynamicResource BaseCompositeInputView}"
											 Required="{Binding Required}"
											 IsValid="{Binding IsValid}"
											 ValidationText="{Binding ValidationText}" BorderBackground="Transparent" >
					<controls:CompositeInputView.CenterView>
						<controls:TemplatedSelector ItemsSource="{Binding Options}"
													SelectedItems="{Binding SelectedOptions, Mode=TwoWay}"
													SelectionMode="Multiple">
							<controls:TemplatedSelector.ItemTemplate>
								<DataTemplate x:DataType="controls:SelectableKycOption">
									<Grid ColumnDefinitions="auto,*" ColumnSpacing="8" Padding="8">
										<controls:AnimatedCheckbox Grid.Column="0" 
											StrokeColor="{DynamicResource ContentAccessWL}"
											FillColor="Transparent"
											StrokeWidth="2"
											IsChecked="{Binding IsSelected, Mode=TwoWay}" />
										<Label Text="{Binding Item.Label.Text}" Grid.Column="1"	
											   VerticalTextAlignment="Center" />
									</Grid>
								</DataTemplate>
							</controls:TemplatedSelector.ItemTemplate>
						</controls:TemplatedSelector>
					</controls:CompositeInputView.CenterView>
				</controls:CompositeInputView>
			</DataTemplate>
			<!-- Boolean (switch) field template -->
			<DataTemplate x:Key="BooleanFieldTemplate"
						  x:DataType="fields:ObservableBooleanField">
				<controls:CompositeInputView LabelText="{Binding Label.Text}"
											 Style="{DynamicResource BaseCompositeInputView}"
											 Required="{Binding Required}"
											 IsValid="{Binding IsValid}"
											 ValidationText="{Binding ValidationText}" >
					<controls:CompositeInputView.CenterView>
						<Grid ColumnDefinitions="auto,*" Margin="8">
							<Switch IsToggled="{Binding BoolValue, Mode=TwoWay}"
									Grid.Column="0" />
							<Label Grid.Column="1"
								   FontSize="Small"
								   Text="{Binding Hint.Text}"
								   VerticalOptions="Center"
								   TextColor="Gray" />
						</Grid>
					</controls:CompositeInputView.CenterView>
				</controls:CompositeInputView>
			</DataTemplate>
			<!-- File upload field template -->
			<DataTemplate x:Key="FileUploadFieldTemplate"
						  x:DataType="fields:ObservableFileField">
				<Grid ColumnDefinitions="*,auto,auto,*"
					  ColumnSpacing="{DynamicResource SmallSpacing}"
					  RowDefinitions="auto,auto,auto,*"
					  RowSpacing="{DynamicResource SmallSpacing}">
					<Border Grid.Row="0"
							Grid.RowSpan="4"
							Grid.Column="1"
							Margin="0"
							Padding="0"
							BackgroundColor="{DynamicResource TnPDangerbgWL}"
							HeightRequest="200"
							Style="{DynamicResource OutlinedImageButtonBorder}"
							VerticalOptions="Start"
							WidthRequest="200">
						<Image Aspect="AspectFill"
							   Source="photo_placeholder">
						</Image>
					</Border>
					<controls:ImageButton Grid.Row="0"
										  Grid.Column="2"
										  PathData="{x:Static ui:Geometries.CameraPhotoButtonPath}"
										  Style="{DynamicResource OutlinedImageButton}"/>
					<controls:ImageButton Grid.Row="1"
										  Grid.Column="2"
										  PathData="{x:Static ui:Geometries.CameraImageButtonPath}"
										  Style="{DynamicResource OutlinedImageButton}" />
					<controls:ImageButton Grid.Row="2"
										  Grid.Column="2"
										  PathData="{x:Static ui:Geometries.TrashCanButtonPath}"
										  Style="{DynamicResource OutlinedImageButton}" />
				</Grid>
			</DataTemplate>
			<!-- Image upload field template -->
			<DataTemplate x:Key="ImageUploadTemplate"
						  x:DataType="fields:ObservableImageField">
				<Grid RowDefinitions="auto, auto, auto"
					  ColumnDefinitions="*,*"
					  ColumnSpacing="16"
					  RowSpacing="8">
					<Border Grid.Row="0"
							Grid.ColumnSpan="2"
							StrokeShape="RoundRectangle 8"
							Stroke="{DynamicResource BrandColorsGreyScalesGreyv250}"
							StrokeDashArray="1,1"
							IsEnabled="{Binding IsValid}">
						<controls:AspectRatioLayout AspectRatio="{Binding AspectRatio, FallbackValue=1.0}">
							<controls:ConditionView Condition="{Binding ImageSource, Converter={mct:IsNullConverter}}">
								<controls:ConditionView.True>
									<!-- Here we can have a image and label, you can create a converter to pick image/svg/label based on the specialType -->
									<Label VerticalOptions="Center"
										   HorizontalOptions="Center"
										   Text="{Binding Placeholder.Text}" />
								</controls:ConditionView.True>
								<controls:ConditionView.False>
									<Image Source="{Binding ImageSource}"
										   Aspect="AspectFit"
										   BackgroundColor="{DynamicResource SurfaceBackgroundWL}" />
								</controls:ConditionView.False>
							</controls:ConditionView>
						</controls:AspectRatioLayout>


						<Border.Triggers>
							<Trigger TargetType="Border"
									 Property="IsEnabled"
									 Value="True">
								<Setter Property="Stroke"
										Value="{DynamicResource BrandColorsGreyScalesGreyv250}" />
							</Trigger>
							<Trigger TargetType="Border"
									 Property="IsEnabled"
									 Value="False">
								<Setter Property="Stroke"
										Value="{DynamicResource InputFieldsContentDangerv500}" />
							</Trigger>
						</Border.Triggers>
					</Border>
					<controls:ConditionView Condition="{Binding AllowUpload}" Grid.Row="1" Grid.ColumnSpan="2">
						<controls:ConditionView.True>
							<Grid ColumnDefinitions="*,*" ColumnSpacing="8">
								<controls:TextButton Style="{DynamicResource TransparentTextButton}"
													 LabelData="{l:Localize CameraPermissionTitle}"
													 Command="{Binding PickPhotoCommand}"/>
								<controls:TextButton Style="{DynamicResource TransparentTextButton}"
													 LabelData="{l:Localize CameraPermissionTitle}"
													 Command="{Binding TakePhotoCommand}"
													 Grid.Column="1"/>
							</Grid>
						</controls:ConditionView.True>
						<controls:ConditionView.False>
							<controls:TextButton Style="{DynamicResource TransparentTextButton}"
										 LabelData="{l:Localize CameraPermissionTitle}"
										 Command="{Binding TakePhotoCommand}"/>
						</controls:ConditionView.False>
					</controls:ConditionView>

					<Label Grid.Row="2" Grid.ColumnSpan="2" HorizontalOptions="Center" Style="{DynamicResource RegularCompositeInputViewValidationLabel}" Text="{Binding ValidationText}" TextColor="Red" IsVisible="{Binding IsValid, Converter={mct:InvertedBoolConverter}}"/>
				</Grid>
			</DataTemplate>
			
			<!-- Label field template -->
			<DataTemplate x:Key="LabelFieldTemplate"
						  x:DataType="fields:ObservableLabelField">
				<Grid>
					<Label Text="{Binding Label.Text}"
					   FontAttributes="Bold"
					   FontSize="Medium" />
				</Grid>
			</DataTemplate>

			<!-- Info field template -->
			<DataTemplate x:Key="InfoFieldTemplate"
						  x:DataType="fields:ObservableInfoField">
				<Border Style="{DynamicResource BorderSet}" Margin="0">
					<VerticalStackLayout>
						<Label Text="{Binding Label.Text}"
							   Style="{DynamicResource FieldTitleLabel}"/>
						<Label Text="{Binding Description.Text}"
							   Style="{DynamicResource FieldValueLabel}"/>
					</VerticalStackLayout>
				</Border>
			</DataTemplate>

			<local:KycFieldTemplateSelector x:Key="KycFieldTemplateSelector"
											BooleanFieldTemplate="{StaticResource BooleanFieldTemplate}"
											DateFieldTemplate="{StaticResource DateFieldTemplate}"
											PickerFieldTemplate="{StaticResource PickerFieldTemplate}"
											IntegerFieldTemplate="{StaticResource IntegerFieldTemplate}"
											DecimalFieldTemplate="{StaticResource DecimalFieldTemplate}"
											RadioFieldTemplate="{StaticResource RadioFieldTemplate}"
											CountryFieldTemplate="{StaticResource CountryFieldTemplate}"
											CheckboxFieldTemplate="{StaticResource CheckboxFieldTemplate}"
											TextFieldTemplate="{StaticResource TextFieldTemplate}"
											FileUploadFieldTemplate="{StaticResource FileUploadFieldTemplate}"
											ImageUploadFieldTemplate="{StaticResource ImageUploadTemplate}"
											LabelFieldTemplate="{StaticResource LabelFieldTemplate}"
											InfoFieldTemplate="{StaticResource InfoFieldTemplate}" />

		</ResourceDictionary>
	</ContentPage.Resources>

	<controls:ConditionView Condition="{Binding IsLoading}">
		<controls:ConditionView.True>
			<Grid Grid.Row="0"
					  Margin="16,16,16,8"
					  ColumnDefinitions="*,auto,*"
					  RowDefinitions="auto, *">
				<controls:SvgButton Grid.Row="0"
										Grid.Column="0"
										Command="{Binding ExitCommand}"
										Style="{DynamicResource IconButton}"
										SvgSource="close.svg"
										HeightRequest="48"
										WidthRequest="48"
										HorizontalOptions="Start" />

				<controls:UriImage Grid.Row="0"
									   Grid.Column="1"
									   Aspect="AspectFit"
									   ErrorPlaceholder="neuro_b"
									   HorizontalOptions="Center"
									   Source="{Binding BannerUri}"
									   WidthRequest="100"
									   HeightRequest="24" />

				<ActivityIndicator IsRunning="True"
									   VerticalOptions="Center"
									   HorizontalOptions="Center"
									   Grid.Row="1"
									   Grid.ColumnSpan="3"
									   Color="{DynamicResource BrandColorsNeuroAccessv500WL}"/>
			</Grid>
		</controls:ConditionView.True>
		<controls:ConditionView.False>

			<Grid Padding="0"
				  Margin="0"
				  RowDefinitions="Auto,*,Auto"
				  Background="{DynamicResource SurfaceBackgroundWL}">

				<Grid Grid.Row="0"
					  Margin="16,16,16,8"
					  ColumnDefinitions="*,auto,*"
					  RowDefinitions="*">
					<controls:SvgButton Grid.Row="0"
										Grid.Column="0"
										Command="{Binding ExitCommand}"
										Style="{DynamicResource IconButton}"
										SvgSource="close.svg"
										HeightRequest="48"
										WidthRequest="48"
										HorizontalOptions="Start" />

					<controls:UriImage Grid.Row="0"
									   Grid.Column="1"
									   Aspect="AspectFit"
									   ErrorPlaceholder="neuro_b"
									   HorizontalOptions="Center"
									   Source="{Binding BannerUri}"
									   WidthRequest="100"
									   HeightRequest="24" />
				</Grid>

				<ScrollView x:Name="FormScrollView"
							Grid.Row="1"
							Padding="{DynamicResource SmallMargins}"
							VerticalOptions="Center">
					<controls:ConditionView Condition="{Binding IsInSummary}">
						<controls:ConditionView.True>
							<VerticalStackLayout>
								<Label Style="{DynamicResource PageTitleLabel}" Text="{l:Localize ApplicationSummary}" Margin="{DynamicResource MediumLeftRightMargins}"/>

							<!-- Post-submission panel: application sent + peer review actions -->
							<Border IsVisible="{Binding ApplicationSentPublic}"
									Style="{DynamicResource BorderSet}">
								<VerticalStackLayout Spacing="{DynamicResource MediumSpacing}">
									<Label Style="{DynamicResource SectionTitleLabel}"
										   Text="{l:Localize Application}" />
									<Label Style="{DynamicResource InfoLabel}"
										   Text="{l:Localize IdApplicationSentDescription}" />

									<!-- Peer review supported -->
									<controls:ConditionView Condition="{Binding PeerReview}">
										<controls:ConditionView.True>
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}">
												<Label Style="{DynamicResource InfoLabel}"
													   Text="{l:Localize PeerReviewDescription}" />
												<Label Style="{DynamicResource InfoLabel}">
													<Label.FormattedText>
														<FormattedString>
															<Span Text="{l:Localize NrPeerReviews}" />
															<Span Text=" " />
															<Span FontAttributes="Bold" Text="{Binding NrReviews}" />
															<Span Text=" / " />
															<Span Text="{Binding NrReviewers}" />
														</FormattedString>
													</Label.FormattedText>
												</Label>

												<Grid RowSpacing="8">
													<controls:TextButton Style="{DynamicResource TransparentTextButton}"
																 LabelData="{l:Localize QrScanCode}"
																 Command="{Binding ScanQrCodeCommand}" Grid.Row="0"/>
													<controls:TextButton Style="{DynamicResource TransparentTextButton}"
																 LabelData="{l:Localize FeaturedReviewers}"
																 Command="{Binding RequestReviewCommand}"
																 IsVisible="{Binding FeaturedPeerReviewers}"
																 Grid.Row="1"/>
												</Grid>
											</VerticalStackLayout>
										</controls:ConditionView.True>
									</controls:ConditionView>

									<controls:TextButton Style="{DynamicResource FilledTextButton}"
													 LabelData="{l:Localize RevokeApplication}"
													 Command="{Binding RevokeApplicationCommand}" />
								</VerticalStackLayout>
							</Border>

								<!-- Rejection/Error banner shown when server reported an error for this application -->
								<controls:ConditionView Condition="{Binding HasErrorDescription}">
									<controls:ConditionView.True>
										<Border Grid.Row="0"
												BackgroundColor="{DynamicResource TnPDangerbgWL}"
												Padding="{DynamicResource MediumMargins}"
												Margin="{DynamicResource SmallMargins}"
												StrokeShape="RoundRectangle 16,16,0,16">
											<Border.Shadow>
												<Shadow Brush="{DynamicResource SurfaceShadowColorWL}" Offset="0,4"/>
											</Border.Shadow>
											<Grid ColumnSpacing="{DynamicResource SmallSpacing}"
													ColumnDefinitions="auto, *">
												<Path Grid.Column="0" Data="{x:Static ui:Geometries.InfoCirclePath}" Fill="{DynamicResource TnPDangerContentWL}"/>
												<Label Grid.Column="1" Text="{Binding ErrorDescription}" Style="{DynamicResource InfoLabel}" TextColor="{DynamicResource TnPDangerContentWL}"/>
											</Grid>
										</Border>
									</controls:ConditionView.True>
								</controls:ConditionView>

								<!-- Info bubble only when not already sent -->
								<Border Grid.Row="0"
										IsVisible="{Binding ApplicationSentPublic, Converter={mct:InvertedBoolConverter}}"
										BackgroundColor="{DynamicResource TnPInfobgWL}"
										Padding="{DynamicResource MediumMargins}"
										Margin="{DynamicResource SmallMargins}"
										StrokeShape="RoundRectangle 16,16,0,16">
									<Border.Shadow>
										<Shadow Brush="{DynamicResource SurfaceShadowColorWL}" Offset="0,4"/>
									</Border.Shadow>
									<Grid ColumnSpacing="{DynamicResource SmallSpacing}"
											ColumnDefinitions="auto, *">
										<Path Grid.Column="0" Data="{x:Static ui:Geometries.InfoCirclePath}" Fill="{DynamicResource TnPInfoContentWL}"/>
										<Label Grid.Column="1"
												Text="Before finalizing, please read through and ensure everything is correct."
												Style="{DynamicResource InfoLabel}"
												TextColor="{DynamicResource TnPInfoContentWL}"/>
									</Grid>
								</Border>
								<Border Style="{DynamicResource BorderSet}">
									<VerticalStackLayout Spacing="{DynamicResource MediumSpacing}">
										<Label Style="{DynamicResource FieldTitleLabel}" Text="{l:Localize ApplicationInformation}"/>

										<!-- Personal Details -->
										<Border Style="{DynamicResource BorderSubSet}">
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Padding="{DynamicResource SmallMargins}">
												<Label Text="{l:Localize PersonalDetails}" Style="{DynamicResource FieldTitleLabel}" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding PersonalInformationSummary}" Spacing="{DynamicResource MediumSpacing}">
													<BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="IDSF:DisplayQuad">
                                    <controls:TemplatedButton Command="{Binding BindingContext.GoToPageWithMappingCommand, Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}}" CommandParameter="{Binding Mapping}" IsEnabled="{Binding FromField}">
                                        <controls:TemplatedButton.Triggers>
                                            <DataTrigger TargetType="controls:TemplatedButton"
                                                        Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}"
                                                        Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="InputTransparent" Value="True" />
                                            </DataTrigger>
                                        </controls:TemplatedButton.Triggers>
																<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto">
																	<Label Text="{Binding Label}" Style="{DynamicResource FieldKeyLabel}" />
																	<Label Text="{Binding Value}" Style="{DynamicResource FieldValueLabel}" Grid.Row="1">
																		<Label.Triggers>
																			<DataTrigger TargetType="Label" Binding="{Binding IsInvalid}" Value="True">
																				<Setter Property="TextColor" Value="{DynamicResource TnPDangerContentWL}" />
																			</DataTrigger>
																		</Label.Triggers>
																	</Label>
																	<controls:SvgView Grid.Column="1" Grid.RowSpan="2" Source="sign.svg" HeightRequest="20" WidthRequest="20" IsVisible="{Binding FromField}" TintColor="{DynamicResource ContentSecondaryWL}">
																		<controls:SvgView.Triggers>
																			<DataTrigger TargetType="controls:SvgView" Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}" Value="True">
																				<Setter Property="IsVisible" Value="False" />
																			</DataTrigger>
																		</controls:SvgView.Triggers>
																	</controls:SvgView>
																</Grid>
															</controls:TemplatedButton>
														</DataTemplate>
													</BindableLayout.ItemTemplate>
												</VerticalStackLayout>
											</VerticalStackLayout>
										</Border>

										<!-- Address Details -->
										<Border Style="{DynamicResource BorderSubSet}">
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Padding="{DynamicResource SmallMargins}">
												<Label Text="{l:Localize AddressDetails}" Style="{DynamicResource FieldTitleLabel}" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding AddressInformationSummary}" Spacing="{DynamicResource MediumSpacing}">
													<BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="IDSF:DisplayQuad">
                                    <controls:TemplatedButton Command="{Binding BindingContext.GoToPageWithMappingCommand, Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}}" CommandParameter="{Binding Mapping}" IsEnabled="{Binding FromField}">
                                        <controls:TemplatedButton.Triggers>
                                            <DataTrigger TargetType="controls:TemplatedButton"
                                                        Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}"
                                                        Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="InputTransparent" Value="True" />
                                            </DataTrigger>
                                        </controls:TemplatedButton.Triggers>
																<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto">
																	<Label Text="{Binding Label}" Style="{DynamicResource FieldKeyLabel}" />
																	<Label Text="{Binding Value}" Style="{DynamicResource FieldValueLabel}" Grid.Row="1">
																		<Label.Triggers>
																			<DataTrigger TargetType="Label" Binding="{Binding IsInvalid}" Value="True">
																				<Setter Property="TextColor" Value="{DynamicResource TnPDangerContentWL}" />
																			</DataTrigger>
																		</Label.Triggers>
																	</Label>
																	<controls:SvgView Grid.Column="1" Grid.RowSpan="2" Source="sign.svg" HeightRequest="20" WidthRequest="20" IsVisible="{Binding FromField}" TintColor="{DynamicResource ContentSecondaryWL}">
																		<controls:SvgView.Triggers>
																			<DataTrigger TargetType="controls:SvgView" Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}" Value="True">
																				<Setter Property="IsVisible" Value="False" />
																			</DataTrigger>
																		</controls:SvgView.Triggers>
																	</controls:SvgView>
																</Grid>
															</controls:TemplatedButton>
														</DataTemplate>
													</BindableLayout.ItemTemplate>
												</VerticalStackLayout>
											</VerticalStackLayout>
										</Border>

										<!-- Company Information -->
										<Border Style="{DynamicResource BorderSubSet}" IsVisible="{Binding HasCompanyInformation}">
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Padding="{DynamicResource SmallMargins}">
												<Label Text="Company Information" Style="{DynamicResource FieldTitleLabel}" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding CompanyInformationSummary}" Spacing="{DynamicResource MediumSpacing}">
													<BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="IDSF:DisplayQuad">
                                    <controls:TemplatedButton Command="{Binding BindingContext.GoToPageWithMappingCommand, Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}}" CommandParameter="{Binding Mapping}" IsEnabled="{Binding FromField}">
                                        <controls:TemplatedButton.Triggers>
                                            <DataTrigger TargetType="controls:TemplatedButton"
                                                        Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}"
                                                        Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="InputTransparent" Value="True" />
                                            </DataTrigger>
                                        </controls:TemplatedButton.Triggers>
																<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto">
																	<Label Text="{Binding Label}" Style="{DynamicResource FieldKeyLabel}" />
																	<Label Text="{Binding Value}" Style="{DynamicResource FieldValueLabel}" Grid.Row="1">
																		<Label.Triggers>
																			<DataTrigger TargetType="Label" Binding="{Binding IsInvalid}" Value="True">
																				<Setter Property="TextColor" Value="{DynamicResource TnPDangerContentWL}" />
																			</DataTrigger>
																		</Label.Triggers>
																	</Label>
																	<controls:SvgView Grid.Column="1" Grid.RowSpan="2" Source="sign.svg" HeightRequest="20" WidthRequest="20" IsVisible="{Binding FromField}" TintColor="{DynamicResource ContentSecondaryWL}">
																		<controls:SvgView.Triggers>
																			<DataTrigger TargetType="controls:SvgView" Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}" Value="True">
																				<Setter Property="IsVisible" Value="False" />
																			</DataTrigger>
																		</controls:SvgView.Triggers>
																	</controls:SvgView>
																</Grid>
															</controls:TemplatedButton>
														</DataTemplate>
													</BindableLayout.ItemTemplate>
												</VerticalStackLayout>
											</VerticalStackLayout>
										</Border>

										<!-- Company Address Information -->
										<Border Style="{DynamicResource BorderSubSet}" IsVisible="{Binding HasCompanyAddress}">
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Padding="{DynamicResource SmallMargins}">
												<Label Text="Company Address" Style="{DynamicResource FieldTitleLabel}" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding CompanyAddressSummary}" Spacing="{DynamicResource MediumSpacing}">
													<BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="IDSF:DisplayQuad">
                                    <controls:TemplatedButton Command="{Binding BindingContext.GoToPageWithMappingCommand, Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}}" CommandParameter="{Binding Mapping}" IsEnabled="{Binding FromField}">
                                        <controls:TemplatedButton.Triggers>
                                            <DataTrigger TargetType="controls:TemplatedButton"
                                                        Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}"
                                                        Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="InputTransparent" Value="True" />
                                            </DataTrigger>
                                        </controls:TemplatedButton.Triggers>
																<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto">
																	<Label Text="{Binding Label}" Style="{DynamicResource FieldKeyLabel}" />
																	<Label Text="{Binding Value}" Style="{DynamicResource FieldValueLabel}" Grid.Row="1" />
																	<controls:SvgView Grid.Column="1" Grid.RowSpan="2" Source="sign.svg" HeightRequest="20" WidthRequest="20" IsVisible="{Binding FromField}" TintColor="{DynamicResource ContentSecondaryWL}">
																		<controls:SvgView.Triggers>
																			<DataTrigger TargetType="controls:SvgView" Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}" Value="True">
																				<Setter Property="IsVisible" Value="False" />
																			</DataTrigger>
																		</controls:SvgView.Triggers>
																	</controls:SvgView>
																</Grid>
															</controls:TemplatedButton>
														</DataTemplate>
													</BindableLayout.ItemTemplate>
												</VerticalStackLayout>
											</VerticalStackLayout>
										</Border>

										<!-- Company Representative -->
										<Border Style="{DynamicResource BorderSubSet}" IsVisible="{Binding HasCompanyRepresentative}">
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Padding="{DynamicResource SmallMargins}">
												<Label Text="Company Representative" Style="{DynamicResource FieldTitleLabel}" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding CompanyRepresentativeSummary}" Spacing="{DynamicResource MediumSpacing}">
													<BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="IDSF:DisplayQuad">
                                    <controls:TemplatedButton Command="{Binding BindingContext.GoToPageWithMappingCommand, Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}}" CommandParameter="{Binding Mapping}" IsEnabled="{Binding FromField}">
                                        <controls:TemplatedButton.Triggers>
                                            <DataTrigger TargetType="controls:TemplatedButton"
                                                        Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}"
                                                        Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="InputTransparent" Value="True" />
                                            </DataTrigger>
                                        </controls:TemplatedButton.Triggers>
																<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto">
																	<Label Text="{Binding Label}" Style="{DynamicResource FieldKeyLabel}" />
																	<Label Text="{Binding Value}" Style="{DynamicResource FieldValueLabel}" Grid.Row="1" />
																	<controls:SvgView Grid.Column="1" Grid.RowSpan="2" Source="sign.svg" HeightRequest="20" WidthRequest="20" IsVisible="{Binding FromField}" TintColor="{DynamicResource ContentSecondaryWL}">
																		<controls:SvgView.Triggers>
																			<DataTrigger TargetType="controls:SvgView" Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}" Value="True">
																				<Setter Property="IsVisible" Value="False" />
																			</DataTrigger>
																		</controls:SvgView.Triggers>
																	</controls:SvgView>
																</Grid>
															</controls:TemplatedButton>
														</DataTemplate>
													</BindableLayout.ItemTemplate>
												</VerticalStackLayout>
											</VerticalStackLayout>
										</Border>

										<!-- Attachments -->
										<Border Style="{DynamicResource BorderSubSet}">
											<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Padding="{DynamicResource SmallMargins}">
												<Label Text="{l:Localize DocumentDetails}" Style="{DynamicResource FieldTitleLabel}" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding AttachmentInformationSummary}" Spacing="{DynamicResource MediumSpacing}">
													<BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="IDSF:DisplayQuad">
                                    <controls:TemplatedButton Command="{Binding BindingContext.GoToPageWithMappingCommand, Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}}" CommandParameter="{Binding Mapping}" IsEnabled="{Binding FromField}">
                                        <controls:TemplatedButton.Triggers>
                                            <DataTrigger TargetType="controls:TemplatedButton"
                                                        Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}"
                                                        Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="InputTransparent" Value="True" />
                                            </DataTrigger>
                                        </controls:TemplatedButton.Triggers>
																<Border Style="{DynamicResource BorderSet}" Margin="0">
																	<Grid ColumnDefinitions="auto, *, auto" ColumnSpacing="{DynamicResource SmallSpacing}">
																		<Border Style="{DynamicResource FileIconBorder}">
																			<controls:SvgView Source="gallery.svg" HeightRequest="24"/>
																		</Border>
																	<Label Grid.Column="1" Text="{Binding Value}" Style="{DynamicResource FieldTitleLabel}" VerticalOptions="Center" Margin="16,0,16,0">
																		<Label.Triggers>
																			<DataTrigger TargetType="Label" Binding="{Binding IsInvalid}" Value="True">
																				<Setter Property="TextColor" Value="{DynamicResource TnPDangerContentWL}" />
																			</DataTrigger>
																		</Label.Triggers>
																	</Label>
																		<controls:SvgView Grid.Column="2" Grid.RowSpan="2" Source="sign.svg" HeightRequest="24" WidthRequest="24" IsVisible="{Binding FromField}" TintColor="{DynamicResource ContentSecondaryWL}">
																			<controls:SvgView.Triggers>
																				<DataTrigger TargetType="controls:SvgView" Binding="{Binding Source={RelativeSource AncestorType={x:Type base:BaseContentPage}}, Path=BindingContext.ApplicationSentPublic}" Value="True">
																					<Setter Property="IsVisible" Value="False" />
																				</DataTrigger>
																			</controls:SvgView.Triggers>
																		</controls:SvgView>
																	</Grid>
																</Border>
															</controls:TemplatedButton>
														</DataTemplate>
													</BindableLayout.ItemTemplate>
												</VerticalStackLayout>
											</VerticalStackLayout>
										</Border>
									</VerticalStackLayout>
								</Border>
							</VerticalStackLayout>
						</controls:ConditionView.True>

						<controls:ConditionView.False>
							<!-- Page header -->
							<VerticalStackLayout Spacing="4" Margin="{DynamicResource SmallMargins}">
								<Label Style="{DynamicResource PageTitleLabel}"
										Text="{Binding CurrentPageTitle}" />
								<Label IsVisible="{Binding HasCurrentPageDescription}"
										Text="{Binding CurrentPageDescription}"
										Margin="0,0,0,16" />

								<!-- Direct fields -->
								<StackLayout IsVisible="{Binding CurrentPage.VisibleFields.Count, Converter={converters:GreaterThanZero}}"
											Spacing="8"
											BindableLayout.ItemsSource="{Binding CurrentPage.VisibleFields}"
											BindableLayout.ItemTemplateSelector="{StaticResource KycFieldTemplateSelector}" />

								<!-- Sections -->
								<StackLayout Spacing="24"
										BindableLayout.ItemsSource="{Binding CurrentPage.VisibleSections}">
									<BindableLayout.ItemTemplate>
										<DataTemplate x:DataType="models:KycSection">
											<VerticalStackLayout Spacing="8">
												<Label FontAttributes="Bold"
														IsVisible="{Binding Label, Converter={mct:IsNotNullConverter}}"
														Style="{DynamicResource SectionHeaderLabel}"
														Text="{Binding Label.Text}" />
												<Label FontAttributes="Bold"
														FontSize="Medium"
														IsVisible="{Binding Description, Converter={mct:IsNotNullConverter}}"
														Text="{Binding Description }" />
												<VerticalStackLayout BindableLayout.ItemsSource="{Binding VisibleFields}"
																	 BindableLayout.ItemTemplateSelector="{StaticResource KycFieldTemplateSelector}"
																	 Spacing="16" />
											</VerticalStackLayout>
										</DataTemplate>
									</BindableLayout.ItemTemplate>
								</StackLayout>
							</VerticalStackLayout>
						</controls:ConditionView.False>

					</controls:ConditionView>
				</ScrollView>

				<!-- Navigation bar (hidden once application is sent) -->
				<Border Style="{DynamicResource BottomBarBorder2}"
							IsVisible="{Binding ApplicationSentPublic, Converter={mct:InvertedBoolConverter}}"
								Grid.Row="2"
								Padding="16">
					<VerticalStackLayout Spacing="8">
						<Grid ColumnDefinitions="*, *">
							<Label Grid.Column="0"
								   Text="{l:Localize Progress}"
								   Style="{DynamicResource FieldKeyLabel}"
								   TextColor="{DynamicResource TnPAccent2ContentWL}"/>
							<Label Grid.Column="1"
								   Text="{Binding ProgressPercent}"
								   HorizontalOptions="End"
								   Style="{DynamicResource FieldKeyLabel}"
								   TextColor="{DynamicResource TnPAccent2ContentWL}"/>
						</Grid>
						<controls:ProgressBar Progress="{Binding Progress}"
											  HeightRequest="16"
											  CornerRadius="32"
											  TrackBrush="{DynamicResource TnPAccent2bgWL}"
											  BarBrush="{DynamicResource TnPAccent2FigureWL}"
											  Margin="{DynamicResource SmallBottomMargins}">
						</controls:ProgressBar>

						<controls:ConditionView Condition="{Binding IsEditingFromSummary}">
							<controls:ConditionView.True>
								<controls:TextButton LabelData="{Binding NextButtonText}"
													 Style="{DynamicResource FilledTextButton}"
													 Command="{Binding GoToSummaryCommand}"/>
							</controls:ConditionView.True>
							<controls:ConditionView.False>
								<Grid ColumnDefinitions="*, *" ColumnSpacing="{DynamicResource SmallSpacing}">
									<controls:TextButton LabelData="{l:Localize Back}"
														 Style="{DynamicResource SecondaryButton}"
														 Command="{Binding GoBackCommand}"/>
									<controls:TextButton LabelData="{Binding NextButtonText}"
														 Style="{DynamicResource PrimaryButton}"
														 Command="{Binding NextCommand}"
														 Grid.Column="1"/>
								</Grid>
							</controls:ConditionView.False>
						</controls:ConditionView>
					</VerticalStackLayout>
				</Border>
			</Grid>
		</controls:ConditionView.False>
	</controls:ConditionView>
</base:BaseContentPage>
