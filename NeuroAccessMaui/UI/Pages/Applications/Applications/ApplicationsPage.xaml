<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Name="ThisPage"
							 x:Class="NeuroAccessMaui.UI.Pages.Applications.Applications.ApplicationsPage"
							 x:DataType="viewmodel:ApplicationsViewModel"
							 xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
							 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
							 xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
							 xmlns:ui="clr-namespace:NeuroAccessMaui.UI"
							 xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
							 xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
							 xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
							 xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
							 xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Applications.Applications"
							 xmlns:service="clr-namespace:NeuroAccessMaui.Services.Kyc">

	<Grid BackgroundColor="{DynamicResource SurfaceBackgroundWL}">

		<controls:Background/>

		<ScrollView>
			<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" Margin="{DynamicResource SmallSpacing}">
				<Grid Margin="{StaticResource SmallLeftRightTopMargins}">
					<controls:SvgButton
						Command="{Binding GoBackCommand}"
						SvgSource="close.svg"
						Style="{DynamicResource IconButton}"
						HorizontalOptions="Start"/>

					<Label Style="{DynamicResource PageTitleLabel}" Text="{l:Localize Applications}" HorizontalOptions="End"/>
				</Grid>

				<!-- Unified Applications List -->
				<Border Style="{DynamicResource BorderSet}">
					<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}">
						<Label Style="{DynamicResource SectionTitleLabel}" Text="{l:Localize IdentityApplications}" />
						<CollectionView ItemsSource="{Binding Applications}" IsVisible="{Binding HasApplications}">
							<CollectionView.ItemTemplate>
								<DataTemplate x:DataType="service:KycReference">
									<controls:TemplatedButton Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ApplicationsViewModel}}, Path=OpenApplicationCommand}"
															 CommandParameter="{Binding}">
										<Border Style="{DynamicResource SecondaryButtonActiveBorder}" >
											<Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" >
												<Label Grid.Row="0" Grid.Column="0" Style="{DynamicResource KeyLabel}" Text="{Binding FriendlyName}" InputTransparent="True" />
												<Label Grid.Row="1" Grid.Column="0" Style="{DynamicResource ValueLabel}" Text="{Binding UpdatedUtc, StringFormat='{}{0:g}'}" InputTransparent="True" />
												<Border Grid.Row="1"
														Grid.Column="1"
														Padding="8,2"
														StrokeShape="RoundRectangle 12 12 12 12" BackgroundColor="{DynamicResource TnPWarningContentWL}"
													   VerticalOptions="Center" InputTransparent="True">
													<Label Text="Current" />
												</Border>
												<controls:TextButton Grid.Row="0" Grid.Column="1" LabelData="X" Style="{DynamicResource PrimaryButton}"
													Command="{Binding Path=RemoveApplicationCommand, Source={RelativeSource AncestorType={x:Type viewmodel:ApplicationsViewModel}}}" CommandParameter="{Binding}"  />
											</Grid>
										</Border>
									</controls:TemplatedButton>
								</DataTemplate>
							</CollectionView.ItemTemplate>
						</CollectionView>
					</VerticalStackLayout>
				</Border>

				<!-- Create new application -->
				<Border Style="{DynamicResource BorderSet}">
					<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}">
						<Label Style="{DynamicResource SectionTitleLabel}" Text="{l:Localize IdentityApplications}" />
						<controls:TemplatedButton HorizontalOptions="Fill" Command="{x:Binding CreateNewApplicationCommand}">
							<Border Style="{DynamicResource PrimaryButtonActiveBorder}" InputTransparent="True">
								<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}" InputTransparent="True">
									<Label Style="{DynamicResource SectionTitleLabel}" Text="New Application" InputTransparent="True"
										   TextColor="{DynamicResource ButtonAccessPrimaryContentWL}"/>
									<Label Style="{DynamicResource KeyLabel}" Text="Temporary" InputTransparent="True"
										   TextColor="{DynamicResource ButtonAccessPrimaryContentWL}"/>
								</VerticalStackLayout>
							</Border>
						</controls:TemplatedButton>
					</VerticalStackLayout>
				</Border>

				<!-- Removed old grouped sections in favor of unified list above -->
			</VerticalStackLayout>
		</ScrollView>
	</Grid>
</base:BaseContentPage>
