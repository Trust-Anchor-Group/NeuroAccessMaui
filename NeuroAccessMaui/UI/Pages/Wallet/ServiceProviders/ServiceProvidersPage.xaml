<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Name="ThisPage"
							 x:Class="NeuroAccessMaui.UI.Pages.Wallet.ServiceProviders.ServiceProvidersPage"
							 x:DataType="viewmodel:ServiceProvidersViewModel"
							 xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
							 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
							 xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
							 xmlns:ui="clr-namespace:NeuroAccessMaui.UI"
							 xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
							 xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
							 xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
							 xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
							 xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Wallet.ServiceProviders">
	<VisualElement.Resources>
		<Style TargetType="Label" ApplyToDerivedTypes="True" x:Key="ServiceProviderTitleLabel">
			<Setter Property="HorizontalOptions" Value="Start"/>
			<Setter Property="VerticalOptions" Value="Center"/>
			<Setter Property="FontFamily"
					  Value="HaasGroteskBold"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="LineBreakMode" Value="WordWrap"/>
		</Style>


		<Style TargetType="Border"
		       x:Key="ServiceProviderCardBorder"
		       BasedOn="{StaticResource BorderSet}">
		</Style>

		<Style TargetType="Border"
		       x:Key="ServiceProviderImageBorder"
		       BasedOn="{StaticResource RoundedBorder}">
			<Setter Property="Padding" Value="{StaticResource SmallMargins}"></Setter>
			<Setter Property="Stroke">
				<Setter.Value>
					<SolidColorBrush Color="{AppThemeBinding Light={StaticResource PrimaryBackgroundDark}, Dark={StaticResource PrimaryBackgroundLight}}"/>
				</Setter.Value>
			</Setter>
			<Setter Property="StrokeThickness"
			        Value="0.5"></Setter>
		</Style>
		<DataTemplate x:Key="ShowImageAndText" x:DataType="viewmodel:ServiceProviderViewModel">
			<controls:TemplatedButton Command="{x:Binding SelectServiceProviderCommand}">
				<Border Style="{StaticResource ServiceProviderCardBorder}" Padding="0">
					<Grid ColumnDefinitions="128,*"
					      RowDefinitions="128"
					      ColumnSpacing="{StaticResource SmallSpacing}">
						<Border Grid.Column="0"
								  Style="{StaticResource ServiceProviderImageBorder}" HeightRequest="100" WidthRequest="100">
							<Image 
							       Source="{Binding IconUrlSource}"
							       Aspect="AspectFit" />
						</Border>

						<Label Grid.Column="1"
						       Text="{Binding Path=Name}"
						       Style="{StaticResource ServiceProviderTitleLabel}"/>
					</Grid>
				</Border>
			</controls:TemplatedButton>
		</DataTemplate>

		<DataTemplate x:Key="ShowImage" x:DataType="viewmodel:ServiceProviderViewModel">
			<controls:TemplatedButton HorizontalOptions="FillAndExpand" Command="{x:Binding SelectServiceProviderCommand}">
				<Border Style="{StaticResource ServiceProviderCardBorder}"
				        Padding="0">
					<Grid ColumnDefinitions="*"
							RowDefinitions="128">
						<Border >
							<Image Source="{Binding IconUrlSource}"
							       Aspect="AspectFit" />
						</Border>
					</Grid>
				</Border>
			</controls:TemplatedButton>
		</DataTemplate>

		<DataTemplate x:Key="ShowText" x:DataType="viewmodel:ServiceProviderViewModel">
			<controls:TemplatedButton Command="{x:Binding SelectServiceProviderCommand}">
				<Border Style="{StaticResource ServiceProviderCardBorder}"
				        Padding="0">
					<Grid ColumnDefinitions="*"
					      RowDefinitions="128"
					      ColumnSpacing="{StaticResource SmallSpacing}">
						<Label Text="{Binding Path=Name}"
						       Style="{StaticResource ServiceProviderTitleLabel}"
						       HorizontalOptions="Center"/>
					</Grid>
				</Border>
			</controls:TemplatedButton>
		</DataTemplate>

		<DataTemplate x:Key="ShowNothing" x:DataType="viewmodel:ServiceProviderViewModel">
			<controls:TemplatedButton HorizontalOptions="FillAndExpand" Command="{x:Binding SelectServiceProviderCommand}">
				<Frame Style="{StaticResource ClickableFrameSubSet}" InputTransparent="True"/>
			</controls:TemplatedButton>
		</DataTemplate>
		<viewmodel:ServiceTemplateSelector x:Key="TemplateSelector"
													  ImageAndTextTemplate="{StaticResource ShowImageAndText}"
													  ImageOnlyTemplate="{StaticResource ShowImage}"
													  TextOnlyTemplate="{StaticResource ShowText}"
													  DefaultTemplate="{StaticResource ShowNothing}"/>

	</VisualElement.Resources>
	<Grid BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryBackgroundLight}, Dark={StaticResource PrimaryBackgroundDark}}">

		<controls:Background/>

		<ScrollView>
			<VerticalStackLayout Spacing="{StaticResource SmallSpacing}" Margin="{StaticResource MediumSpacing}">
				<Grid ColumnDefinitions="auto,*">
					<controls:ImageButton Grid.Column="0"
												HorizontalOptions="Start"
					                      Command="{Binding GoBackCommand}"
					                      Style="{StaticResource ImageOnlyButton}"
					                      PathData="{x:Static ui:Geometries.BackButtonPath}" />

					<Label Grid.Column="1"
							 HorizontalOptions="End"
					       Text="{Binding Path=Title}"
					       Style="{StaticResource PageTitleLabel}" />
				</Grid>


				<Border Style="{StaticResource BorderSet}">
					<VerticalStackLayout Spacing="{StaticResource LargeSpacing}">
						<Label Text="{Binding Path=Description}" HorizontalOptions="Center" VerticalOptions="Start"/>

						<VerticalStackLayout BindableLayout.ItemsSource="{Binding ServiceProviders}"
													BindableLayout.ItemTemplateSelector="{StaticResource TemplateSelector}"/>
					</VerticalStackLayout>
				</Border>
			</VerticalStackLayout>
		</ScrollView>
	</Grid>
</base:BaseContentPage>
