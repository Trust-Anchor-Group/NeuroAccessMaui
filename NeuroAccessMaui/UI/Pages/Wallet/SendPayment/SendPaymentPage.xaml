<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Name="ThisPage"
							 x:Class="NeuroAccessMaui.UI.Pages.Wallet.SendPayment.SendPaymentPage"
							 x:DataType="viewmodel:EDalerUriViewModel"
							 xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
							 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
							 xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
							 xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
							 xmlns:ui="clr-namespace:NeuroAccessMaui.UI"
							 xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
							 xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
							 xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
							 xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Wallet">
	<Grid BackgroundColor="{DynamicResource SurfaceBackgroundWL}" RowDefinitions="auto, *">

		<controls:Background/>

		<Grid ColumnDefinitions="auto, *">
			<controls:SvgButton HorizontalOptions="Start" Command="{Binding GoBackCommand}"
								Style="{DynamicResource IconButton}" SvgSource="close.svg"/>

			<Label Text="{l:Localize SendPayment}" Style="{DynamicResource PageTitleLabel}" Grid.Column="1" HorizontalOptions="End"/>
		</Grid>
		
		<ScrollView Grid.Row="1">
			<VerticalStackLayout Spacing="{DynamicResource SmallSpacing}">
				<!-- Balance card -->
				<Border Style="{DynamicResource BorderSet}"
						Margin="8,0,8,0"
						Grid.Row="1">
					<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto" RowSpacing="0" ColumnSpacing="{DynamicResource SmallSpacing}">
						<!-- Balance title-->
						<HorizontalStackLayout Spacing="{DynamicResource SmallSpacing}">
							<controls:SvgView Source="wallet.svg"
											  TintColor="{DynamicResource ContentPrimaryWL}"
											  Aspect="AspectFit"
											  WidthRequest="24"
											  HeightRequest="24"/>
							<Label Grid.Column="1" Grid.Row="0"
									HorizontalOptions="Start"
									Text="{l:Localize CreditBalance}"
									FontSize="16"
									LineHeight="0.8"
									Style="{DynamicResource PageTitleLabel}"
									VerticalOptions="Center"/>
						</HorizontalStackLayout>

						<controls:TemplatedButton Command="{Binding GetBalanceTask.RefreshCommand}"
									Grid.Column="1"
									HorizontalOptions="End">
							<Grid ColumnDefinitions="*, auto" Margin="0,4,0,0">
								<Label Text="{Binding BalanceUpdated, Converter={converters:DateTimeToLastUpdatedConverter}}"
						Style="{DynamicResource KeyLabel}"
						FontSize="12"
						FontFamily="HaasGroteskRegular"
						VerticalOptions="Center"
						Margin="0,0,8,0"/>
								<controls:SvgView Source="refresh.svg"
									WidthRequest="24"
									HeightRequest="24"
									TintColor="{DynamicResource ContentPrimaryWL}"
									IsVisible="{Binding GetBalanceTask.IsNotRunning}"
									Grid.Column="1"/>
								<ActivityIndicator IsRunning="True"
									WidthRequest="24"
									HeightRequest="24"
									IsVisible="{Binding GetBalanceTask.IsRunning}"
									Grid.Column="1"/>
							</Grid>
						</controls:TemplatedButton>

						<!-- Extra Grid required to give the NC label enough size to expand -->
						<Grid Grid.Row="1" Grid.ColumnSpan="2" ColumnDefinitions="*, auto" ColumnSpacing="{DynamicResource SmallSpacing}">
							<!-- Balance -->
							<Label LineBreakMode="CharacterWrap"
					VerticalOptions="End">
								<Label.FormattedText>
									<FormattedString>
										<Span Text="{Binding Path=BalanceDecimal}" FontSize="48" FontFamily="SpaceGroteskBold"/>
										<Span Text=" NC" FontSize="32" FontFamily="SpaceGroteskBold"/>
									</FormattedString>
								</Label.FormattedText>
							</Label>
						</Grid>
					</Grid>
				</Border>


				<Border Style="{DynamicResource BorderSet}">
					<VerticalStackLayout Spacing="{DynamicResource MediumSpacing}">
						<!-- Note -->
						<Label Text="{l:Localize To}" Margin="0,8,0,0" Style="{DynamicResource Brand2LabelS}"/>
						<controls:CompositeEntry Style="{DynamicResource RegularCompositeEntry}" EntryData="{Binding Path=To}" IsReadOnly="{Binding Path=ToPreset}"/>
						<controls:TextButton Command="{Binding SelectRecipientCommand}" LabelData="{l:Localize SelectContact}" Style="{DynamicResource OutlinedTextButton}" />
						<Label Text="{l:Localize Amount}" Margin="0,16,0,0"/>
						<Grid ColumnDefinitions="*,auto" RowDefinitions="auto" Padding="0" Margin="0" ColumnSpacing="0" RowSpacing="0">
							<controls:CompositeEntry Style="{DynamicResource RegularCompositeEntry}" EntryData="{Binding Path=AmountText}"
									 BackgroundColor="{Binding Path=AmountOk, Converter={converters:ControlBgColor}}"
									 Placeholder="{Binding Path=Currency}" IsReadOnly="{Binding Path=AmountPreset}"/>
							<controls:ImageButton Grid.Column="1" Grid.Row="0" IsEnabled="{Binding Path=AmountPreset}"
														 PathData="{x:Static ui:Geometries.CalculatorPath}"
														 Command="{Binding OpenCalculatorCommand}" CommandParameter="AmountText"
														 Style="{DynamicResource ImageOnlyButton}"/>
						</Grid>
						<Label Text="{l:Localize AmountExtra}" IsVisible="{Binding Path=AmountPreset}"/>
						<Grid ColumnDefinitions="*,auto" RowDefinitions="auto" Padding="0" Margin="0" ColumnSpacing="0" RowSpacing="0" IsVisible="{Binding Path=AmountPreset}">
							<controls:CompositeEntry Style="{DynamicResource RegularCompositeEntry}" EntryData="{Binding Path=AmountExtraText}" BackgroundColor="{Binding Path=AmountExtraOk, Converter={converters:ControlBgColor}}" 
									 Placeholder="{Binding Path=Currency}" IsVisible="{Binding Path=AmountPreset}"/>
							<controls:ImageButton IsEnabled="{Binding Path=AmountPreset}" PathData="{x:Static ui:Geometries.CalculatorPath}"
														 Command="{Binding OpenCalculatorCommand}" CommandParameter="AmountExtraText"
														 Style="{DynamicResource ImageOnlyButton}"/>
						</Grid>
						<Label Text="{l:Localize Message}" Margin="0,16,0,0"/>
						<controls:CompositeEntry Style="{DynamicResource RegularCompositeEntry}" EntryData="{Binding Path=Message}" IsReadOnly="{Binding Path=MessagePreset}"/>
						<Grid ColumnDefinitions="auto,*" IsVisible="False" RowDefinitions="auto" Margin="{DynamicResource SmallTopBottomMargins}">
							<CheckBox Grid.Column="0" Grid.Row="0" IsChecked="{Binding Path=EncryptMessage, Mode=TwoWay}" VerticalOptions="Center" IsEnabled="{Binding CanEncryptMessage}"/>
							<Label Grid.Column="1" Grid.Row="0" Text="{l:Localize EncryptMessage}" VerticalOptions="Center" Margin="{DynamicResource SmallLeftMargins}"/>
						</Grid>
						<!-- BUTTONS -->
						<controls:TextButton LabelData="{l:Localize Send}" Command="{Binding Path=SendPaymentCommand}"
											 Margin="0,16,0,8" Style="{DynamicResource FilledTextButton}"/>
					</VerticalStackLayout>
				</Border>
			</VerticalStackLayout>
		</ScrollView>
	</Grid>
</base:BaseContentPage>
