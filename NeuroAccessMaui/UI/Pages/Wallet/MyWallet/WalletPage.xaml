<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Name="ThisPage"
							 x:Class="NeuroAccessMaui.UI.Pages.Wallet.MyWallet.WalletPage"
							 x:DataType="viewmodel:WalletViewModel"
							 xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
							 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
							 xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
							 xmlns:ui="clr-namespace:NeuroAccessMaui.UI"
							 xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
							 xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
							 xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
							 xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
							 xmlns:objectmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Wallet.MyWallet.ObjectModels"
							 xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Wallet.MyWallet">
	<VisualElement.Resources>
		<DataTemplate x:Key="DefaultTemplate">
			<Grid />
		</DataTemplate>

		<DataTemplate x:Key="PendingPaymentTemplate" x:DataType="objectmodel:PendingPaymentItem">
			<Grid ColumnDefinitions="2*,*" RowDefinitions="auto,auto">
				<Label Grid.Column="0" Grid.Row="0" Text="{Binding Path=FriendlyName}" Style="{StaticResource KeyLabel}" LineBreakMode="TailTruncation" FontAttributes="Bold" FontSize="18"/>
				<Label Grid.Column="0" Grid.Row="1" Text="{Binding Path=ExpiresStr}" Style="{StaticResource KeyLabel}" LineBreakMode="TailTruncation" FontAttributes="Italic"/>
				<Label Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" LineBreakMode="TailTruncation" TextColor="{StaticResource PendingColor}" HorizontalTextAlignment="End">
					<Label.FormattedText>
						<FormattedString>
							<Span Text="-" FontSize="30" FontAttributes="Bold"/>
							<Span Text="{Binding Path=Amount, Converter={converters:MoneyToString}}" FontSize="30" FontAttributes="Bold"/>
							<Span Text=" "/>
							<Span Text="{Binding Path=Currency}" FontSize="20"/>
						</FormattedString>
					</Label.FormattedText>
				</Label>
				<Grid.GestureRecognizers>
					<TapGestureRecognizer Command="{Binding Path=BindingContext.ShowPaymentItemCommand, Source={x:Reference ThisPage}}" CommandParameter="{Binding}" />
				</Grid.GestureRecognizers>
			</Grid>
		</DataTemplate>

		<DataTemplate x:Key="AccountEventTemplate" x:DataType="objectmodel:AccountEventItem">
			<Grid ColumnDefinitions="2*,*" RowDefinitions="auto,auto,auto">
				<Label Grid.Column="0" Grid.Row="0" Text="{Binding Path=FriendlyName}" Style="{StaticResource KeyLabel}" LineBreakMode="TailTruncation" FontAttributes="Bold" FontSize="18"/>
				<Label Grid.Row="0" Grid.Column="1" FontSize="50" Padding="0,-25,0,-25"
					   Text="•"  HorizontalOptions="Start" VerticalOptions="Center" IsVisible="{Binding New}"
					   Style="{StaticResource AlertLabel}"/>
				<Label Grid.Column="0" Grid.Row="1" Text="{Binding Path=TimestampStr}" Style="{StaticResource KeyLabel}" LineBreakMode="TailTruncation"/>
				<Label Grid.Column="1" Grid.Row="0" LineBreakMode="TailTruncation" HorizontalTextAlignment="End">
					<Label.FormattedText>
						<FormattedString>
							<Span Text="{Binding Path=Change, Converter={converters:MoneyToString}}" FontSize="18" FontAttributes="Bold" TextColor="{Binding Path=TextColor}"/>
							<Span Text=" "/>
							<Span Text="{Binding Path=Currency}" FontSize="16" TextColor="{Binding Path=TextColor}"/>
						</FormattedString>
					</Label.FormattedText>
				</Label>
				<Label Grid.Column="1" Grid.Row="1" LineBreakMode="TailTruncation" HorizontalTextAlignment="End">
					<Label.FormattedText>
						<FormattedString>
							<Span Text=" ("/>
							<Span Text="{Binding Path=Balance, Converter={converters:MoneyToString}}" FontSize="14"/>
							<Span Text="{Binding Path=ReservedSuffix}" FontSize="14" TextColor="{StaticResource PendingColor}"/>
							<Span Text=" "/>
							<Span Text="{Binding Path=Currency}" FontSize="12"/>
							<Span Text=" ) "/>
						</FormattedString>
					</Label.FormattedText>
				</Label>
				<Label Grid.Column="0" Grid.Row="2" Text="{Binding Path=Message}" IsVisible="{Binding Path=HasMessage}" LineBreakMode="TailTruncation"/>
				<Grid.GestureRecognizers>
					<TapGestureRecognizer Command="{Binding Path=BindingContext.ShowPaymentItemCommand, Source={x:Reference ThisPage}}" CommandParameter="{Binding}" />
				</Grid.GestureRecognizers>
			</Grid>
		</DataTemplate>

		<viewmodel:AccountItemTypeTemplateSelector x:Key="AccountItemStyleSelector"
																 DefaultTemplate="{StaticResource DefaultTemplate}"
																 PendingPaymentTemplate="{StaticResource PendingPaymentTemplate}"
																 AccountEventTemplate="{StaticResource AccountEventTemplate}"/>
	</VisualElement.Resources>
	<Grid x:Name="TheMainGrid"
			RowDefinitions="auto, *"
			ColumnDefinitions="*"
			BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryBackgroundLight}, Dark={StaticResource PrimaryBackgroundDark}}">

		<controls:Background Grid.Row="1" />

		<ScrollView>
			<VerticalStackLayout Padding="{StaticResource MediumMargins}">
				<!-- Top Bar -->
				<Grid Grid.Row="0"
						RowDefinitions="*"
						ColumnDefinitions="auto,*">


					<controls:ImageButton Grid.Row="0"
												 Grid.Column="0"
												 Command="{Binding GoBackCommand}"
												 Style="{StaticResource ImageOnlyButton}"
												 PathData="{x:Static ui:Geometries.BackButtonPath}" />

					<Label Grid.Row="0"
							 Grid.Column="1"
							 Style="{StaticResource PageTitleLabel}"
							 Text="{l:Localize Wallet}"
							 HorizontalTextAlignment="Start" />
				</Grid>

				<!-- Balance card -->
				<Border Style="{StaticResource BorderSet}"
						  Padding="{StaticResource LargeMargins}"
						  StrokeThickness="0.4">
					<Border.Stroke>
						<SolidColorBrush Color="Grey" />
					</Border.Stroke>

					<VerticalStackLayout Spacing="{StaticResource MediumSpacing}">
						<!-- Balance title-->
						<Grid Grid.Row="0"
								ColumnDefinitions="auto, *, auto"
								RowDefinitions="auto"
								ColumnSpacing="{StaticResource SmallSpacing}"
								Margin="0"
								Padding="0">
							<Path Data="{x:Static ui:Geometries.ContractPath}"
									Grid.Column="0"
									Fill="Black"
									WidthRequest="16"
									HeightRequest="16"
									Aspect="Uniform" />
							<Label Grid.Column="1"
									 Text="Neuro-Credits Balance"
									 FontSize="26"
									 LineHeight="0.8"
									 Style="{StaticResource PageTitleLabel}" />

							<controls:TemplatedButton Command="{Binding RefreshBalanceCommand}"
															  Grid.Column="2"
															  WidthRequest="24"
															  HeightRequest="24"
															  HorizontalOptions="Center"
															  IsVisible="{Binding IsRefreshingBalance, Converter={mct:InvertedBoolConverter}}">
								<Path Data="{x:Static ui:Geometries.InfoCirclePath}"
										Grid.Column="2"
										Fill="Black"
										HorizontalOptions="Center"
										Aspect="Uniform" />
							</controls:TemplatedButton>
							<ActivityIndicator IsRunning="True"
													 Grid.Column="2"
													 WidthRequest="24"
													 HeightRequest="24"
													 HorizontalOptions="Center"
													 IsVisible="{Binding IsRefreshingBalance}" />


						</Grid>
						<!-- Balance -->
						<Grid Grid.Row="1"
								RowDefinitions="auto, auto">

							<Label Grid.Row="0"
									 Text="{Binding Path=BalanceDecimal}"
									 Style="{StaticResource PageTitleLabel}" />
							<Label Grid.Row="1"
									 Text="Last updated: null"
									 Style="{StaticResource KeyLabel}"
									 FontSize="12"
									 Margin="0"
									 FontFamily="HaasGroteskRegular" />
						</Grid>

						<controls:TextButton LabelData="Buy Neuro-Credits" Command="{Binding BuyEdalerCommand}"
													Style="{StaticResource FilledTextButton}" />
					</VerticalStackLayout>
				</Border>

				<CollectionView
									 >
					<CollectionView.Header>
						<VerticalStackLayout>
							
						</VerticalStackLayout>
					</CollectionView.Header>
				</CollectionView>
			</VerticalStackLayout>	  
		</ScrollView>

	</Grid>
</base:BaseContentPage>
