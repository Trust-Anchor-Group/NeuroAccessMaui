<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Class="NeuroAccessMaui.UI.Pages.Wallet.TransactionHistory.TransactionHistoryPage"
                      xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                      xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                      xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
                      xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
                      xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
                      xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Wallet.TransactionHistory"
                      x:DataType="viewmodel:TransactionHistoryViewModel">

    <Grid RowDefinitions="auto,*" BackgroundColor="{DynamicResource SurfaceBackgroundWL}">
        <!-- Top bar -->
        <Grid ColumnDefinitions="auto,*,auto" Margin="16,16,16,8">
            <controls:SvgButton SvgSource="close.svg" Style="{DynamicResource IconButton}" Command="{Binding BackCommand}" />
            <Label Grid.Column="1" Text="{l:Localize History}" Style="{DynamicResource PageTitleLabel}" HorizontalTextAlignment="Center" />
            <controls:SvgButton Grid.Column="2" SvgSource="refresh.svg" Style="{DynamicResource IconButton}" Command="{Binding RefreshCommand}" />
        </Grid>

        <!-- Content -->
        <Grid Grid.Row="1" RowDefinitions="auto,*,auto" Margin="16,0,16,16">
            <!-- Search -->
            <controls:CompositeEntry Grid.Row="0"
                                     Placeholder="{l:Localize Search}"
                                     EntryData="{Binding SearchText}"
                                     Style="{DynamicResource RegularCompositeEntry}"
                                     Margin="0,0,0,16" />

            <!-- Events list -->
            <ScrollView Grid.Row="1">
                <VerticalStackLayout Spacing="16"
                                     BindableLayout.ItemsSource="{Binding Events}">
                    <BindableLayout.EmptyView>
                        <VerticalStackLayout Padding="32" Spacing="12" HorizontalOptions="Center" VerticalOptions="Center">
                            <controls:SvgView Source="history.svg" HeightRequest="64" WidthRequest="64" TintColor="{DynamicResource ContentSecondaryWL}" />
                            <Label Text="{l:Localize NoTransactionsYet}" Style="{DynamicResource KeyLabel}" HorizontalTextAlignment="Center" />
                        </VerticalStackLayout>
                    </BindableLayout.EmptyView>
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="viewmodel:TransactionEventItem">
                            <Border Style="{DynamicResource BorderSet}" Margin="0" Padding="0">
                                <Grid ColumnDefinitions="*,auto" RowDefinitions="auto,auto" Padding="8">
                                    <Label Grid.Column="0" Grid.Row="0" Text="{Binding FriendlyName}" Style="{DynamicResource KeyLabel}" FontAttributes="Bold" LineBreakMode="TailTruncation" />
									<Label Grid.Column="1" Grid.Row="0" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" TextColor="{Binding ChangeColor}" >
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding Change, Converter={StaticResource MoneyToString}}" FontSize="18" FontAttributes="Bold" />
                                                <Span Text=" " />
												<Span Text="NC" FontSize="16" FontAttributes="Bold" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label Grid.Column="0" Grid.Row="1" Text="{Binding TimestampStr}" Style="{DynamicResource ValueLabel}" VerticalTextAlignment="Center" />
                                    <Label Grid.Column="1" Grid.Row="1" HorizontalTextAlignment="Center" VerticalTextAlignment="Center">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text=" (" />
                                                <Span Text="{Binding Balance, Converter={StaticResource MoneyToString}}" />
                                                <Span Text="{Binding ReservedSuffix}" FontSize="14" TextColor="{DynamicResource PendingColor}" />
                                                <Span Text=" " />
                                                <Span Text="NC" />
                                                <Span Text=" ) " />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </ScrollView>

            <!-- Load More Button -->
            <controls:TextButton Grid.Row="2"
								 Margin="0,16,0,0"
								 LabelData="{l:Localize LoadMore}"
								 Style="{DynamicResource SecondaryButton}"
								 Command="{Binding LoadMoreCommand}"
								 IsVisible="{Binding HasMore}" />
        </Grid>
    </Grid>
</base:BaseContentPage>
