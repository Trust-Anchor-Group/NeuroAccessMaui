<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage x:Class="NeuroAccessMaui.UI.Pages.Wallet.TransactionHistory.TransactionHistoryPage"
					  x:DataType="viewmodel:TransactionHistoryViewModel"
                      xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                      xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                      xmlns:base="clr-namespace:NeuroAccessMaui.UI.Pages"
                      xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
                      xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
                      xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Pages.Wallet.TransactionHistory">

    <Grid RowDefinitions="auto,*" BackgroundColor="{DynamicResource SurfaceBackgroundWL}">
        <!-- Top bar -->
        <Grid ColumnDefinitions="auto,*,auto" Margin="16,16,16,8">
            <controls:SvgButton SvgSource="close.svg" Style="{DynamicResource IconButton}" Command="{Binding BackCommand}" />
            <Label Grid.Column="1" Text="{l:Localize History}" Style="{DynamicResource PageTitleLabel}" HorizontalTextAlignment="Center" />
            <controls:SvgButton Grid.Column="2" SvgSource="refresh.svg" Style="{DynamicResource IconButton}" Command="{Binding RefreshCommand}" />
        </Grid>

        <!-- Content -->
        <Grid Grid.Row="1" RowDefinitions="auto,*,auto" Margin="16,0,16,16">
            <!-- Search -->
            <controls:CompositeEntry Grid.Row="0"
                                     Placeholder="{l:Localize Search}"
                                     EntryData="{Binding SearchText}"
                                     Style="{DynamicResource RegularCompositeEntry}"
                                     Margin="0,0,0,16" />

			<controls:ConditionView Condition="{Binding IsLoading}" Grid.Row="1">
				<controls:ConditionView.True>
					<ActivityIndicator IsRunning="True"
									   VerticalOptions="Center"
									   HorizontalOptions="Center"
								       Color="{DynamicResource ContentPrimaryWL}"
									   HeightRequest="48"
									   WidthRequest="48" />
				</controls:ConditionView.True>
				<controls:ConditionView.False>
					<!-- Events list -->
					<ScrollView>
						<VerticalStackLayout Spacing="16"
											 BindableLayout.ItemsSource="{Binding Events}">
							<BindableLayout.EmptyView>
								<VerticalStackLayout Padding="32" Spacing="12" HorizontalOptions="Center" VerticalOptions="Center">
									<controls:SvgView Source="history.svg" HeightRequest="64" WidthRequest="64" TintColor="{DynamicResource ContentSecondaryWL}" />
									<Label Text="{l:Localize NoTransactionsYet}" Style="{DynamicResource KeyLabel}" HorizontalTextAlignment="Center" />
								</VerticalStackLayout>
							</BindableLayout.EmptyView>
							<BindableLayout.ItemTemplate>
								<DataTemplate x:DataType="viewmodel:TransactionEventItem">
									<controls:TemplatedButton Command="{Binding OpenDetailsCommand}">
										<Border Style="{DynamicResource BorderSet}" Margin="0" Padding="0">
											<Grid ColumnDefinitions="auto, *" RowDefinitions="auto,auto" Padding="16" RowSpacing="4" ColumnSpacing="8">
												<Label Grid.Column="0" Text="{Binding TransactionType}" Style="{DynamicResource Brand2LabelSSecondary}"/>
												<Label Grid.Column="1" Grid.Row="0" Text="{Binding FriendlyName}" Style="{DynamicResource Brand2LabelS}" FontAttributes="Bold" LineBreakMode="TailTruncation" HorizontalOptions="End" />
												<Label Grid.Column="0" Grid.Row="1" Text="{Binding TimestampStr}" Style="{DynamicResource Brand2LabelSSecondary}"/>
												<Label Grid.Column="1" Grid.Row="1" HorizontalTextAlignment="End" TextColor="{Binding ChangeColor}" LineBreakMode="TailTruncation" >
													<Label.FormattedText>
														<FormattedString>
															<Span Text="{Binding Change}" FontSize="18" FontAttributes="Bold" />
															<Span Text=" " />
															<Span Text="{Binding Currency}" FontSize="18" FontAttributes="Bold" />
														</FormattedString>
													</Label.FormattedText>
												</Label>
											</Grid>
										</Border>
									</controls:TemplatedButton>
								</DataTemplate>
							</BindableLayout.ItemTemplate>
						</VerticalStackLayout>
					</ScrollView>
				</controls:ConditionView.False>
			</controls:ConditionView>

			<!-- Load More Button -->
            <controls:TextButton Grid.Row="2"
								 Margin="0,16,0,0"
								 LabelData="{l:Localize LoadMore}"
								 Style="{DynamicResource SecondaryButton}"
								 Command="{Binding LoadMoreCommand}"
								 IsVisible="{Binding HasMore}" />
        </Grid>
    </Grid>
</base:BaseContentPage>
