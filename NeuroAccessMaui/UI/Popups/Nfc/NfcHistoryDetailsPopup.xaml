<?xml version="1.0" encoding="UTF-8" ?>
<base:BasePopup x:Class="NeuroAccessMaui.UI.Popups.Nfc.NfcHistoryDetailsPopup"
				x:DataType="viewmodel:NfcHistoryDetailsPopupViewModel"
				xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
				xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
				xmlns:l="clr-namespace:NeuroAccessMaui.Services.Localization"
				xmlns:controls="clr-namespace:NeuroAccessMaui.UI.Controls"
				xmlns:converters="clr-namespace:NeuroAccessMaui.UI.Converters"
				xmlns:base="clr-namespace:NeuroAccessMaui.UI.Popups"
				xmlns:viewmodel="clr-namespace:NeuroAccessMaui.UI.Popups.Nfc"
				xmlns:nfc="clr-namespace:NeuroAccessMaui.Services.Nfc.Ui">

	<base:BasePopup.Resources>
		<converters:StringNotEqualsConverter x:Key="StringNotEqualsConverter" />
	</base:BasePopup.Resources>

	<Grid Style="{DynamicResource PopupGrid}">
		<Border
			WidthRequest="{Binding ViewWidthRequest}"
			MaximumHeightRequest="{Binding MaximumViewHeightRequest}"
			Style="{DynamicResource PopupBorder}">

			<ScrollView VerticalOptions="Center">
				<VerticalStackLayout Spacing="12">
					<Label Style="{DynamicResource PageTitleLabelSmall}"
						   Text="{l:Localize Details}"/>

					<Border Style="{DynamicResource BorderSubSet}">
						<VerticalStackLayout Spacing="12">
							<Grid ColumnDefinitions="*, auto"
									RowDefinitions="auto, auto">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding CopyValueCommand}"
											CommandParameter="{Binding Item.TagType}"/>
								</Grid.GestureRecognizers>

								<Label Grid.Row="0"
										Grid.Column="0"
										Text="{l:Localize NfcFieldType}"
										Style="{DynamicResource FieldKeyLabel}"/>
								<controls:SvgView Grid.Row="0"
										Grid.Column="1"
										Aspect="AspectFit"
										HeightRequest="16"
										WidthRequest="16"
										Source="content_copy.svg"
										TintColor="{DynamicResource ContentSecondaryWL}"/>
								<Label Grid.Row="1"
										Grid.ColumnSpan="2"
										Text="{Binding Item.TagType}"
										Style="{DynamicResource FieldValueLabel}"
										TextColor="{DynamicResource ContentLinkWL}"
										LineBreakMode="CharacterWrap"/>
							</Grid>

							<Grid ColumnDefinitions="*, auto"
									RowDefinitions="auto, auto">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding CopyValueCommand}"
											CommandParameter="{Binding Item.TagIdHex}"/>
								</Grid.GestureRecognizers>

								<Label Grid.Row="0"
										Grid.Column="0"
										Text="{l:Localize NfcFieldId}"
										Style="{DynamicResource FieldKeyLabel}"/>
								<controls:SvgView Grid.Row="0"
										Grid.Column="1"
										Aspect="AspectFit"
										HeightRequest="16"
										WidthRequest="16"
										Source="content_copy.svg"
										TintColor="{DynamicResource ContentSecondaryWL}"/>
								<Label Grid.Row="1"
										Grid.ColumnSpan="2"
										Text="{Binding Item.TagIdHex}"
										Style="{DynamicResource FieldValueLabel}"
										TextColor="{DynamicResource ContentLinkWL}"
										LineBreakMode="CharacterWrap"/>
							</Grid>

							<Grid ColumnDefinitions="*, auto"
									RowDefinitions="auto, auto">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding CopyValueCommand}"
											CommandParameter="{Binding Item.DetectedAtUtc, StringFormat='{0:O}'}"/>
								</Grid.GestureRecognizers>

								<Label Grid.Row="0"
										Grid.Column="0"
										Text="{l:Localize NfcFieldDetectedUtc}"
										Style="{DynamicResource FieldKeyLabel}"/>
								<controls:SvgView Grid.Row="0"
										Grid.Column="1"
										Aspect="AspectFit"
										HeightRequest="16"
										WidthRequest="16"
										Source="content_copy.svg"
										TintColor="{DynamicResource ContentSecondaryWL}"/>
								<Label Grid.Row="1"
										Grid.ColumnSpan="2"
										Text="{Binding Item.DetectedAtUtc, StringFormat='{0:O}'}"
										Style="{DynamicResource FieldValueLabel}"
										TextColor="{DynamicResource ContentLinkWL}"
										LineBreakMode="CharacterWrap"/>
							</Grid>

							<Grid ColumnDefinitions="*, auto"
									RowDefinitions="auto, auto">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding CopyValueCommand}"
											CommandParameter="{Binding Item.InterfacesSummary}"/>
								</Grid.GestureRecognizers>

								<Label Grid.Row="0"
										Grid.Column="0"
										Text="{l:Localize NfcFieldTechnologies}"
										Style="{DynamicResource FieldKeyLabel}"/>
								<controls:SvgView Grid.Row="0"
										Grid.Column="1"
										Aspect="AspectFit"
										HeightRequest="16"
										WidthRequest="16"
										Source="content_copy.svg"
										TintColor="{DynamicResource ContentSecondaryWL}"/>
								<Label Grid.Row="1"
										Grid.ColumnSpan="2"
										Text="{Binding Item.InterfacesSummary}"
										Style="{DynamicResource FieldValueLabel}"
										TextColor="{DynamicResource ContentLinkWL}"
										LineBreakMode="CharacterWrap"/>
							</Grid>
						</VerticalStackLayout>
					</Border>

					<Border Style="{DynamicResource BorderSubSet}"
							IsVisible="{Binding HasNdefInfo}">
						<VerticalStackLayout Spacing="12">
							<Grid ColumnDefinitions="*, auto"
									RowDefinitions="auto, auto"
									IsVisible="{Binding HasNdefSummary}">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding CopyValueCommand}"
											CommandParameter="{Binding Item.NdefSummary}"/>
								</Grid.GestureRecognizers>

								<Label Grid.Row="0"
										Grid.Column="0"
										Text="{l:Localize NfcFieldNdef}"
										Style="{DynamicResource FieldKeyLabel}"/>
								<controls:SvgView Grid.Row="0"
										Grid.Column="1"
										Aspect="AspectFit"
										HeightRequest="16"
										WidthRequest="16"
										Source="content_copy.svg"
										TintColor="{DynamicResource ContentSecondaryWL}"/>
								<Label Grid.Row="1"
										Grid.ColumnSpan="2"
										Text="{Binding Item.NdefSummary}"
										Style="{DynamicResource FieldValueLabel}"
										TextColor="{DynamicResource ContentLinkWL}"
										LineBreakMode="CharacterWrap"/>
							</Grid>

							<Grid ColumnDefinitions="*, auto"
									RowDefinitions="auto, auto"
									IsVisible="{Binding HasUri}">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding CopyValueCommand}"
											CommandParameter="{Binding Item.ExtractedUri}"/>
								</Grid.GestureRecognizers>

								<Label Grid.Row="0"
										Grid.Column="0"
										Text="URI"
										Style="{DynamicResource FieldKeyLabel}"/>
								<controls:SvgView Grid.Row="0"
										Grid.Column="1"
										Aspect="AspectFit"
										HeightRequest="16"
										WidthRequest="16"
										Source="content_copy.svg"
										TintColor="{DynamicResource ContentSecondaryWL}"/>
								<Label Grid.Row="1"
										Grid.ColumnSpan="2"
										Text="{Binding Item.ExtractedUri}"
										Style="{DynamicResource FieldValueLabel}"
										TextColor="{DynamicResource ContentLinkWL}"
										LineBreakMode="CharacterWrap"/>
							</Grid>
						</VerticalStackLayout>
					</Border>

					<VerticalStackLayout Spacing="8">
						<controls:TextButton 
											 Command="{Binding CopyUriCommand}"
											 Style="{DynamicResource OutlinedTextButton}"
											 LabelData="{l:Localize CopyToClipboard}"
											 IsVisible="{Binding HasUri}"/>
						<controls:TextButton 
											 Command="{Binding OpenUriCommand}"
											 Style="{DynamicResource FilledTextButton}"
											 LabelData="{l:Localize Open}"
											 IsVisible="{Binding HasUri}"/>
						<controls:TextButton 
											 Command="{Binding ExportJsonCommand}"
											 Style="{DynamicResource OutlinedTextButton}"
											 LabelData="{l:Localize Export}"/>
						<controls:TextButton 
											 Command="{Binding ExportXmlCommand}"
											 Style="{DynamicResource OutlinedTextButton}"
											 LabelData="{l:Localize NfcExportXml}"/>
					</VerticalStackLayout>

					<Border Style="{DynamicResource BorderSubSet}"
							IsVisible="{Binding HasNdefRecords}">
						<VerticalStackLayout Spacing="8">
							<Label Text="{l:Localize NfcFieldNdefRecords}"
								   Style="{DynamicResource FieldKeyLabel}"/>
							<CollectionView ItemsSource="{Binding Item.NdefRecords}"
											SelectionMode="None">
								<CollectionView.ItemTemplate>
									<DataTemplate x:DataType="nfc:NfcNdefRecordSnapshot">
										<VerticalStackLayout Spacing="8" Padding="0,6">
											<Label Text="{Binding RecordType}"
												   Style="{DynamicResource FieldTitleLabel}"/>
											<Label Text="{Binding DisplayValue}"
												   Style="{DynamicResource FieldValueLabel}"
												   LineBreakMode="CharacterWrap"/>

											<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto">
												<Grid.GestureRecognizers>
													<TapGestureRecognizer
														Command="{Binding BindingContext.CopyValueCommand, Source={RelativeSource AncestorType={x:Type base:BasePopup}}}"
														CommandParameter="{Binding PayloadSizeBytes}" />
												</Grid.GestureRecognizers>
												<Label Grid.Row="0" Grid.Column="0" Text="Payload (bytes)" Style="{DynamicResource FieldKeyLabel}"/>
												<controls:SvgView Grid.Row="0" Grid.Column="1" Aspect="AspectFit" HeightRequest="16" WidthRequest="16" Source="content_copy.svg" TintColor="{DynamicResource ContentSecondaryWL}"/>
												<Label Grid.Row="1" Grid.ColumnSpan="2" Text="{Binding PayloadSizeBytes}" Style="{DynamicResource FieldValueLabel}" TextColor="{DynamicResource ContentLinkWL}"/>
											</Grid>

											<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto"
													IsVisible="{Binding PayloadBase64, Converter={StaticResource StringNotEqualsConverter}, ConverterParameter=''}">
												<Grid.GestureRecognizers>
													<TapGestureRecognizer
														Command="{Binding BindingContext.CopyValueCommand, Source={RelativeSource AncestorType={x:Type base:BasePopup}}}"
														CommandParameter="{Binding PayloadBase64}" />
												</Grid.GestureRecognizers>
												<Label Grid.Row="0" Grid.Column="0" Text="Payload (Base64)" Style="{DynamicResource FieldKeyLabel}"/>
												<controls:SvgView Grid.Row="0" Grid.Column="1" Aspect="AspectFit" HeightRequest="16" WidthRequest="16" Source="content_copy.svg" TintColor="{DynamicResource ContentSecondaryWL}"/>
												<Label Grid.Row="1" Grid.ColumnSpan="2" Text="{Binding PayloadBase64}" Style="{DynamicResource FieldValueLabel}" TextColor="{DynamicResource ContentLinkWL}" LineBreakMode="TailTruncation" MaxLines="3"/>
											</Grid>

											<Grid ColumnDefinitions="*, auto" RowDefinitions="auto, auto"
													IsVisible="{Binding PayloadHex, Converter={StaticResource StringNotEqualsConverter}, ConverterParameter=''}">
												<Grid.GestureRecognizers>
													<TapGestureRecognizer
														Command="{Binding BindingContext.CopyValueCommand, Source={RelativeSource AncestorType={x:Type base:BasePopup}}}"
														CommandParameter="{Binding PayloadHex}" />
												</Grid.GestureRecognizers>
												<Label Grid.Row="0" Grid.Column="0" Text="Payload (hex)" Style="{DynamicResource FieldKeyLabel}"/>
												<controls:SvgView Grid.Row="0" Grid.Column="1" Aspect="AspectFit" HeightRequest="16" WidthRequest="16" Source="content_copy.svg" TintColor="{DynamicResource ContentSecondaryWL}"/>
												<Label Grid.Row="1" Grid.ColumnSpan="2" Text="{Binding PayloadHex}" Style="{DynamicResource FieldValueLabel}" TextColor="{DynamicResource ContentLinkWL}" LineBreakMode="TailTruncation" MaxLines="3"/>
											</Grid>
										</VerticalStackLayout>
									</DataTemplate>
								</CollectionView.ItemTemplate>
							</CollectionView>
						</VerticalStackLayout>
					</Border>

					<controls:TextButton
						Command="{Binding CloseCommand}"
						Style="{DynamicResource OutlinedTextButton}"
						LabelData="{l:Localize Cancel}"/>
				</VerticalStackLayout>
			</ScrollView>
		</Border>
	</Grid>
</base:BasePopup>
